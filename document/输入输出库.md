# 一、头文件

```c
#include <iomanip>
#include <ios>
#include <iosfwd>
#include <fstream>
#include <iostream>
#include <istream>
#include <ostream>
#include <sstream>
#include <streambuf>
//#include <strstream> // deprecated in C++98

#include <filesystem> // Since C++17
#include <syncstream> // Since C++20
#include <spanstream> // Since C++23
#include <print>
```



# 二、输入/输出库

C++ 包括以下输入/输出库：一个 [OOP 风格](https://en.wikipedia.org/wiki/Object-oriented_programming) [基于流的 I/O](https://cppreference.cn/w/cpp/io#Stream-based_I.2FO) 库，[基于打印的函数族](https://cppreference.cn/w/cpp/io#Print_functions_.28since_C.2B.2B23.29)(C++23 起)，以及标准的 [C 风格 I/O](https://cppreference.cn/w/cpp/io#C-style_I.2FO) 函数集。

###  基于流的 I/O

基于流的输入/输出库围绕抽象的输入/输出设备组织。 这些抽象设备允许相同的代码处理到文件、内存流或自定义适配器设备的输入/输出，这些适配器设备可以动态执行任意操作（例如，压缩）。

大多数类都是模板化的，因此它们可以适应任何基本字符类型。 为最常见的基本字符类型（char 和 wchar_t）提供了单独的类型别名。 这些类组织成以下层次结构

![std-io-complete-inheritance.svg](https://cppreference.cn/mwiki/images/0/06/std-io-complete-inheritance.svg)

继承图



| 抽象                                                         |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 定义于头文件 `<ios>`                                         |                                                              |
| [ ios_base](https://cppreference.cn/w/cpp/io/ios_base)       | 管理格式化标志和输入/输出异常  (类)                          |
| [ basic_ios](https://cppreference.cn/w/cpp/io/basic_ios)     | 管理任意流缓冲区  (类模板)                                   |
| 定义于头文件 `<streambuf>`                                   |                                                              |
| [ basic_streambuf](https://cppreference.cn/w/cpp/io/basic_streambuf) | 抽象原始设备  (类模板)                                       |
| 定义于头文件 `<ostream>`                                     |                                                              |
| [ basic_ostream](https://cppreference.cn/w/cpp/io/basic_ostream) | 包装给定的抽象设备 ([std::basic_streambuf](https://cppreference.cn/w/cpp/io/basic_streambuf)) 并提供高级输出接口  (类模板) |
| 定义于头文件 `<istream>`                                     |                                                              |
| [ basic_istream](https://cppreference.cn/w/cpp/io/basic_istream) | 包装给定的抽象设备 ([std::basic_streambuf](https://cppreference.cn/w/cpp/io/basic_streambuf)) 并提供高级输入接口  (类模板) |
| [ basic_iostream](https://cppreference.cn/w/cpp/io/basic_iostream) | 包装给定的抽象设备 ([std::basic_streambuf](https://cppreference.cn/w/cpp/io/basic_streambuf)) 并提供高级输入/输出接口  (类模板) |
| 文件 I/O 实现                                                |                                                              |
| 定义于头文件 `<fstream>`                                     |                                                              |
| [ basic_filebuf](https://cppreference.cn/w/cpp/io/basic_filebuf) | 实现原始文件设备  (类模板)                                   |
| [ basic_ifstream](https://cppreference.cn/w/cpp/io/basic_ifstream) | 实现高级文件流输入操作  (类模板)                             |
| [ basic_ofstream](https://cppreference.cn/w/cpp/io/basic_ofstream) | 实现高级文件流输出操作  (类模板)                             |
| [ basic_fstream](https://cppreference.cn/w/cpp/io/basic_fstream) | 实现高级文件流输入/输出操作  (类模板)                        |
| 字符串 I/O 实现                                              |                                                              |
| 定义于头文件 `<sstream>`                                     |                                                              |
| [ basic_stringbuf](https://cppreference.cn/w/cpp/io/basic_stringbuf) | 实现原始字符串设备  (类模板)                                 |
| [ basic_istringstream](https://cppreference.cn/w/cpp/io/basic_istringstream) | 实现高级字符串流输入操作  (类模板)                           |
| [ basic_ostringstream](https://cppreference.cn/w/cpp/io/basic_ostringstream) | 实现高级字符串流输出操作  (类模板)                           |
| [ basic_stringstream](https://cppreference.cn/w/cpp/io/basic_stringstream) | 实现高级字符串流输入/输出操作  (类模板)                      |
| 数组 I/O 实现                                                |                                                              |
| 定义于头文件 `<spanstream>`                                  |                                                              |
| [ basic_spanbuf](https://cppreference.cn/w/cpp/io/basic_spanbuf)(C++23) | 实现原始固定字符缓冲区设备  (类模板)                         |
| [ basic_ispanstream](https://cppreference.cn/w/cpp/io/basic_ispanstream)(C++23) | 实现固定字符缓冲区输入操作  (类模板)                         |
| [ basic_ospanstream](https://cppreference.cn/w/cpp/io/basic_ospanstream)(C++23) | 实现固定字符缓冲区输出操作  (类模板)                         |
| [ basic_spanstream](https://cppreference.cn/w/cpp/io/basic_spanstream)(C++23) | 实现固定字符缓冲区输入/输出操作  (类模板)                    |
| 定义于头文件 `<strstream>`                                   |                                                              |
| [ strstreambuf](https://cppreference.cn/w/cpp/io/strstreambuf)(C++98 中已弃用)(C++26 中已移除) | 实现原始字符数组设备  (类)                                   |
| [ istrstream](https://cppreference.cn/w/cpp/io/istrstream)(C++98 中已弃用)(C++26 中已移除) | 实现字符数组输入操作  (类)                                   |
| [ ostrstream](https://cppreference.cn/w/cpp/io/ostrstream)(C++98 中已弃用)(C++26 中已移除) | 实现字符数组输出操作  (类)                                   |
| [ strstream](https://cppreference.cn/w/cpp/io/strstream)(C++98 中已弃用)(C++26 中已移除) | 实现字符数组输入/输出操作  (类)                              |
| 同步输出 (C++20 起)                                          |                                                              |
| 定义于头文件 `<syncstream>`                                  |                                                              |
| [ basic_syncbuf](https://cppreference.cn/w/cpp/io/basic_syncbuf)(C++20) | 同步输出设备包装器  (类模板)                                 |
| [ basic_osyncstream](https://cppreference.cn/w/cpp/io/basic_osyncstream)(C++20) | 同步输出流包装器  (类模板)                                   |

####  类型别名

以下常见字符类型的类型别名在命名空间 `std` 中提供

| 类型                                                         | 定义                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 定义于头文件 `<ios>`                                         |                                                              |
| std::ios                                                     | [std::basic_ios](https://cppreference.cn/w/cpp/io/basic_ios)<char> |
| std::wios                                                    | [std::basic_ios](https://cppreference.cn/w/cpp/io/basic_ios)<wchar_t> |
| 定义于头文件 `<streambuf>`                                   |                                                              |
| [std::streambuf](https://cppreference.cn/w/cpp/io/basic_streambuf) | [std::basic_streambuf](https://cppreference.cn/w/cpp/io/basic_streambuf)<char> |
| [std::wstreambuf](https://cppreference.cn/w/cpp/io/basic_streambuf) | [std::basic_streambuf](https://cppreference.cn/w/cpp/io/basic_streambuf)<wchar_t> |
| 定义于头文件 `<istream>`                                     |                                                              |
| [std::istream](https://cppreference.cn/w/cpp/io/basic_istream) | [std::basic_istream](https://cppreference.cn/w/cpp/io/basic_istream)<char> |
| [std::wistream](https://cppreference.cn/w/cpp/io/basic_istream) | [std::basic_istream](https://cppreference.cn/w/cpp/io/basic_istream)<wchar_t> |
| [std::iostream](https://cppreference.cn/w/cpp/io/basic_iostream) | [std::basic_iostream](https://cppreference.cn/w/cpp/io/basic_iostream)<char> |
| [std::wiostream](https://cppreference.cn/w/cpp/io/basic_iostream) | [std::basic_iostream](https://cppreference.cn/w/cpp/io/basic_iostream)<wchar_t> |
| 定义于头文件 `<ostream>`                                     |                                                              |
| [std::ostream](https://cppreference.cn/w/cpp/io/basic_ostream) | [std::basic_ostream](https://cppreference.cn/w/cpp/io/basic_ostream)<char> |
| [std::wostream](https://cppreference.cn/w/cpp/io/basic_ostream) | [std::basic_ostream](https://cppreference.cn/w/cpp/io/basic_ostream)<wchar_t> |
| 定义于头文件 `<fstream>`                                     |                                                              |
| [std::filebuf](https://cppreference.cn/w/cpp/io/basic_filebuf) | [std::basic_filebuf](https://cppreference.cn/w/cpp/io/basic_filebuf)<char> |
| [std::wfilebuf](https://cppreference.cn/w/cpp/io/basic_filebuf) | [std::basic_filebuf](https://cppreference.cn/w/cpp/io/basic_filebuf)<wchar_t> |
| [std::ifstream](https://cppreference.cn/w/cpp/io/basic_ifstream) | [std::basic_ifstream](https://cppreference.cn/w/cpp/io/basic_ifstream)<char> |
| [std::wifstream](https://cppreference.cn/w/cpp/io/basic_ifstream) | [std::basic_ifstream](https://cppreference.cn/w/cpp/io/basic_ifstream)<wchar_t> |
| [std::ofstream](https://cppreference.cn/w/cpp/io/basic_ofstream) | [std::basic_ofstream](https://cppreference.cn/w/cpp/io/basic_ofstream)<char> |
| [std::wofstream](https://cppreference.cn/w/cpp/io/basic_ofstream) | [std::basic_ofstream](https://cppreference.cn/w/cpp/io/basic_ofstream)<wchar_t> |
| [std::fstream](https://cppreference.cn/w/cpp/io/basic_fstream) | [std::basic_fstream](https://cppreference.cn/w/cpp/io/basic_fstream)<char> |
| [std::wfstream](https://cppreference.cn/w/cpp/io/basic_fstream) | [std::basic_fstream](https://cppreference.cn/w/cpp/io/basic_fstream)<wchar_t> |
| 定义于头文件 `<sstream>`                                     |                                                              |
| [std::stringbuf](https://cppreference.cn/w/cpp/io/basic_stringbuf) | [std::basic_stringbuf](https://cppreference.cn/w/cpp/io/basic_stringbuf)<char> |
| [std::wstringbuf](https://cppreference.cn/w/cpp/io/basic_stringbuf) | [std::basic_stringbuf](https://cppreference.cn/w/cpp/io/basic_stringbuf)<wchar_t> |
| [std::istringstream](https://cppreference.cn/w/cpp/io/basic_istringstream) | [std::basic_istringstream](https://cppreference.cn/w/cpp/io/basic_istringstream)<char> |
| [std::wistringstream](https://cppreference.cn/w/cpp/io/basic_istringstream) | [std::basic_istringstream](https://cppreference.cn/w/cpp/io/basic_istringstream)<wchar_t> |
| [std::ostringstream](https://cppreference.cn/w/cpp/io/basic_ostringstream) | [std::basic_ostringstream](https://cppreference.cn/w/cpp/io/basic_ostringstream)<char> |
| [std::wostringstream](https://cppreference.cn/w/cpp/io/basic_ostringstream) | [std::basic_ostringstream](https://cppreference.cn/w/cpp/io/basic_ostringstream)<wchar_t> |
| [std::stringstream](https://cppreference.cn/w/cpp/io/basic_stringstream) | [std::basic_stringstream](https://cppreference.cn/w/cpp/io/basic_stringstream)<char> |
| [std::wstringstream](https://cppreference.cn/w/cpp/io/basic_stringstream) | [std::basic_stringstream](https://cppreference.cn/w/cpp/io/basic_stringstream)<wchar_t> |
| 定义于头文件 `<spanstream>`                                  |                                                              |
| std::spanbuf (C++23 起)                                      | [std::basic_spanbuf](https://cppreference.cn/w/cpp/io/basic_spanbuf)<char> |
| std::wspanbuf (C++23 起)                                     | [std::basic_spanbuf](https://cppreference.cn/w/cpp/io/basic_spanbuf)<wchar_t> |
| std::ispanstream (C++23 起)                                  | [std::basic_ispanstream](https://cppreference.cn/w/cpp/io/basic_ispanstream)<char> |
| std::wispanstream (C++23 起)                                 | [std::basic_ispanstream](https://cppreference.cn/w/cpp/io/basic_ispanstream)<wchar_t> |
| std::ospanstream (C++23 起)                                  | [std::basic_ospanstream](https://cppreference.cn/w/cpp/io/basic_ospanstream)<char> |
| std::wospanstream (C++23 起)                                 | [std::basic_ospanstream](https://cppreference.cn/w/cpp/io/basic_ospanstream)<wchar_t> |
| std::spanstream (C++23 起)                                   | [std::basic_spanstream](https://cppreference.cn/w/cpp/io/basic_spanstream)<char> |
| std::wspanstream (C++23 起)                                  | [std::basic_spanstream](https://cppreference.cn/w/cpp/io/basic_spanstream)<wchar_t> |
| 定义于头文件 `<syncstream>`                                  |                                                              |
| std::syncbuf (C++20 起)                                      | [std::basic_syncbuf](https://cppreference.cn/w/cpp/io/basic_syncbuf)<char> |
| std::wsyncbuf (C++20 起)                                     | [std::basic_syncbuf](https://cppreference.cn/w/cpp/io/basic_syncbuf)<wchar_t> |
| std::osyncstream (C++20 起)                                  | [std::basic_osyncstream](https://cppreference.cn/w/cpp/io/basic_osyncstream)<char> |
| std::wosyncstream (C++20 起)                                 | [std::basic_osyncstream](https://cppreference.cn/w/cpp/io/basic_osyncstream)<wchar_t> |



####  预定义的标准流对象

| 定义于头文件 `<iostream>`                           |                                                              |
| --------------------------------------------------- | ------------------------------------------------------------ |
| [ cinwcin](https://cppreference.cn/w/cpp/io/cin)    | 从标准 C 输入流 [stdin](https://cppreference.cn/w/cpp/io/c/std_streams) 读取 (全局对象) |
| [ coutwcout](https://cppreference.cn/w/cpp/io/cout) | 写入到标准 C 输出流 [stdout](https://cppreference.cn/w/cpp/io/c/std_streams) (全局对象) |
| [ cerrwcerr](https://cppreference.cn/w/cpp/io/cerr) | 写入到标准 C 错误流 [stderr](https://cppreference.cn/w/cpp/io/c/std_streams)，无缓冲 (全局对象) |
| [ clogwclog](https://cppreference.cn/w/cpp/io/clog) | 写入到标准 C 错误流 [stderr](https://cppreference.cn/w/cpp/io/c/std_streams) (全局对象) |

####  [I/O 操纵符](https://cppreference.cn/w/cpp/io/manip)

基于流的 I/O 库使用 [I/O 操纵符](https://cppreference.cn/w/cpp/io/manip)（例如 [std::boolalpha](https://cppreference.cn/w/cpp/io/manip/boolalpha)、 [std::hex](https://cppreference.cn/w/cpp/io/manip/hex) 等）来控制流的行为。

####  类型

定义了以下辅助类型

| 定义于头文件 `<ios>`                                       |                                                              |
| ---------------------------------------------------------- | ------------------------------------------------------------ |
| [ streamoff](https://cppreference.cn/w/cpp/io/streamoff)   | 表示相对文件/流位置（从 fpos 的偏移量），足以表示任何文件大小  (类型别名) |
| [ streamsize](https://cppreference.cn/w/cpp/io/streamsize) | 表示 I/O 操作中传输的字符数或 I/O 缓冲区的大小  (类型别名)   |
| [ fpos](https://cppreference.cn/w/cpp/io/fpos)             | 表示流或文件中的绝对位置  (类模板)                           |



为 [std::fpos](https://cppreference.cn/w/cpp/io/fpos)<[std::mbstate_t](https://cppreference.cn/w/cpp/string/multibyte/mbstate_t)> 提供了以下类型别名

| 定义于头文件 `<iosfwd>`        |                                                              |
| ------------------------------ | ------------------------------------------------------------ |
| 类型                           | 定义                                                         |
| `std::streampos`               | [std::fpos](https://cppreference.cn/w/cpp/io/fpos)<[std::char_traits](https://cppreference.cn/w/cpp/string/char_traits)<char>::state_type> |
| `std::wstreampos`              | [std::fpos](https://cppreference.cn/w/cpp/io/fpos)<[std::char_traits](https://cppreference.cn/w/cpp/string/char_traits)<wchar_t>::state_type> |
| `std::u8streampos` (C++20 起)  | [std::fpos](https://cppreference.cn/w/cpp/io/fpos)<[std::char_traits](https://cppreference.cn/w/cpp/string/char_traits)<char8_t>::state_type> |
| `std::u16streampos` (C++11 起) | [std::fpos](https://cppreference.cn/w/cpp/io/fpos)<[std::char_traits](https://cppreference.cn/w/cpp/string/char_traits)<char16_t>::state_type> |
| `std::u32streampos` (C++11 起) | [std::fpos](https://cppreference.cn/w/cpp/io/fpos)<[std::char_traits](https://cppreference.cn/w/cpp/string/char_traits)<char32_t>::state_type> |



####  错误类别接口 (自 C++11 起)

| 定义于头文件 `<ios>`                                         |                                |
| ------------------------------------------------------------ | ------------------------------ |
| [ io_errc](https://cppreference.cn/w/cpp/io/io_errc)(C++11)  | IO 流错误码  (枚举)            |
| [ iostream_category](https://cppreference.cn/w/cpp/io/iostream_category)(C++11) | 标识 iostream 错误类别  (函数) |



###  打印函数 (自 C++23 起)

Unicode 感知的打印系列函数，用于对已格式化的文本执行格式化 I/O。 它们带来了 [std::format](https://cppreference.cn/w/cpp/utility/format/format) 的所有性能优势，默认情况下与区域设置无关，减少了全局状态，避免了分配临时的 [std::string](https://cppreference.cn/w/cpp/string/basic_string) 对象和调用 operator<<，并且通常使格式化比 [iostreams](https://cppreference.cn/w/cpp/io#Stream-based_I.2FO) 和 [stdio](https://cppreference.cn/w/cpp/io#C-style_I.2FO) 更有效。

提供了以下类似打印的函数

| 定义于头文件 `<print>`                                       |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| [ print](https://cppreference.cn/w/cpp/io/print)(C++23)      | 使用参数的 [格式化](https://cppreference.cn/w/cpp/utility/format) 表示打印到 [stdout](https://cppreference.cn/w/cpp/io/c/std_streams) 或文件流  (函数模板) |
| [ println](https://cppreference.cn/w/cpp/io/println)(C++23)  | 与 std::print 相同，但每次打印都以额外的换行符结尾  (函数模板) |
| [ vprint_unicodevprint_unicode_buffered](https://cppreference.cn/w/cpp/io/vprint_unicode)(C++23) | 使用 [类型擦除的](https://cppreference.cn/w/cpp/utility/format/basic_format_args) 参数表示打印到支持 Unicode 的 [stdout](https://cppreference.cn/w/cpp/io/c/std_streams) 或文件流  (函数) |
| [ vprint_nonunicodevprint_nonunicode_buffered](https://cppreference.cn/w/cpp/io/vprint_nonunicode)(C++23) | 使用 [类型擦除的](https://cppreference.cn/w/cpp/utility/format/basic_format_args) 参数表示打印到 [stdout](https://cppreference.cn/w/cpp/io/c/std_streams) 或文件流  (函数) |
|                                                              |                                                              |
| 定义于头文件 `<ostream>`                                     |                                                              |
| [ print(std::ostream)](https://cppreference.cn/w/cpp/io/basic_ostream/print)(C++23) | 输出参数的 [格式化](https://cppreference.cn/w/cpp/utility/format) 表示  (函数模板) |
| [ println(std::ostream)](https://cppreference.cn/w/cpp/io/basic_ostream/println)(C++23) | 输出参数的 [格式化](https://cppreference.cn/w/cpp/utility/format) 表示，并附加 '\n'  (函数模板) |

###  [C 风格 I/O](https://cppreference.cn/w/cpp/io/c)

C++ 还包括 [C 定义的输入/输出函数](https://cppreference.cn/w/cpp/io/c)，例如 [std::fopen](https://cppreference.cn/w/cpp/io/c/fopen)、 [std::getc](https://cppreference.cn/w/cpp/io/c/fgetc) 等。



# 三、分类

| [I/O 操纵符](https://cppreference.cn/w/cpp/io/manip)         |
| ------------------------------------------------------------ |
| [打印函数](https://cppreference.cn/w/cpp/io#Print_functions_.28since_C.2B.2B23.29) (C++23 起) |
| [C 风格 I/O](https://cppreference.cn/w/cpp/io/c)             |
| 缓冲区                                                       |
| [basic_streambuf](https://cppreference.cn/w/cpp/io/basic_streambuf) |
| [basic_filebuf](https://cppreference.cn/w/cpp/io/basic_filebuf) |
| [basic_stringbuf](https://cppreference.cn/w/cpp/io/basic_stringbuf) |
| [basic_spanbuf](https://cppreference.cn/w/cpp/io/basic_spanbuf)(C++23) |
| [strstreambuf](https://cppreference.cn/w/cpp/io/strstreambuf)(C++98/26* 弃用/移除) |
| [basic_syncbuf](https://cppreference.cn/w/cpp/io/basic_syncbuf)(C++20) |
| 流                                                           |
| 抽象                                                         |
| [ios_base](https://cppreference.cn/w/cpp/io/ios_base)        |
| [basic_ios](https://cppreference.cn/w/cpp/io/basic_ios)      |
| [basic_istream](https://cppreference.cn/w/cpp/io/basic_istream) |
| [basic_ostream](https://cppreference.cn/w/cpp/io/basic_ostream) |
| [basic_iostream](https://cppreference.cn/w/cpp/io/basic_iostream) |
| 文件 I/O                                                     |
| [basic_ifstream](https://cppreference.cn/w/cpp/io/basic_ifstream) |
| [basic_ofstream](https://cppreference.cn/w/cpp/io/basic_ofstream) |
| [basic_fstream](https://cppreference.cn/w/cpp/io/basic_fstream) |
| 字符串 I/O                                                   |
| [basic_istringstream](https://cppreference.cn/w/cpp/io/basic_istringstream) |
| [basic_ostringstream](https://cppreference.cn/w/cpp/io/basic_ostringstream) |
| [basic_stringstream](https://cppreference.cn/w/cpp/io/basic_stringstream) |
| 数组 I/O                                                     |
| [basic_ispanstream](https://cppreference.cn/w/cpp/io/basic_ispanstream)(C++23) |
| [basic_ospanstream](https://cppreference.cn/w/cpp/io/basic_ospanstream)(C++23) |
| [basic_spanstream](https://cppreference.cn/w/cpp/io/basic_spanstream)(C++23) |
| [istrstream](https://cppreference.cn/w/cpp/io/istrstream)(C++98/26* 弃用/移除) |
| [ostrstream](https://cppreference.cn/w/cpp/io/ostrstream)(C++98/26* 弃用/移除) |
| [strstream](https://cppreference.cn/w/cpp/io/strstream)(C++98/26* 弃用/移除) |
| 同步输出                                                     |
| [basic_osyncstream](https://cppreference.cn/w/cpp/io/basic_osyncstream)(C++20) |
| 类型                                                         |
| [streamoff](https://cppreference.cn/w/cpp/io/streamoff)      |
| [streamsize](https://cppreference.cn/w/cpp/io/streamsize)    |
| [fpos](https://cppreference.cn/w/cpp/io/fpos)                |
| 错误类别接口                                                 |
| [iostream_category](https://cppreference.cn/w/cpp/io/iostream_category)(C++11) |
| [io_errc](https://cppreference.cn/w/cpp/io/io_errc)(C++11)   |

## basic抽象基类

###  [std::basic_istream](https://cppreference.cn/w/cpp/io/basic_istream)

 成员函数

| 格式化输入                                                   |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| [ operator>>](https://cppreference.cn/w/cpp/io/basic_istream/operator_gtgt) | 提取格式化数据  (`std::basic_istream<CharT,Traits>` 的公有成员函数) |
| 非格式化输入                                                 |                                                              |
| [ get](https://cppreference.cn/w/cpp/io/basic_istream/get)   | 提取字符  (`std::basic_istream<CharT,Traits>` 的公有成员函数) |
| [ peek](https://cppreference.cn/w/cpp/io/basic_istream/peek) | 读取下一个字符，但不提取它  (`std::basic_istream<CharT,Traits>` 的公有成员函数) |
| [ unget](https://cppreference.cn/w/cpp/io/basic_istream/unget) | 取消提取一个字符  (`std::basic_istream<CharT,Traits>` 的公有成员函数) |
| [ putback](https://cppreference.cn/w/cpp/io/basic_istream/putback) | 将一个字符放回输入流  (`std::basic_istream<CharT,Traits>` 的公有成员函数) |
| [ getline](https://cppreference.cn/w/cpp/io/basic_istream/getline) | 提取字符直到找到给定的字符  (`std::basic_istream<CharT,Traits>` 的公有成员函数) |
| [ ignore](https://cppreference.cn/w/cpp/io/basic_istream/ignore) | 提取并丢弃字符直到找到给定的字符  (`std::basic_istream<CharT,Traits>` 的公有成员函数) |
| [ read](https://cppreference.cn/w/cpp/io/basic_istream/read) | 提取字符块  (`std::basic_istream<CharT,Traits>` 的公有成员函数) |
| [ readsome](https://cppreference.cn/w/cpp/io/basic_istream/readsome) | 提取已有的字符块  (`std::basic_istream<CharT,Traits>` 的公有成员函数) |
| [ gcount](https://cppreference.cn/w/cpp/io/basic_istream/gcount) | 返回上次非格式化输入操作提取的字符数  (`std::basic_istream<CharT,Traits>` 的公有成员函数) |
| 定位                                                         |                                                              |
| [ tellg](https://cppreference.cn/w/cpp/io/basic_istream/tellg) | 返回输入位置指示器  (`std::basic_istream<CharT,Traits>` 的公有成员函数) |
| [ seekg](https://cppreference.cn/w/cpp/io/basic_istream/seekg) | 设置输入位置指示器  (`std::basic_istream<CharT,Traits>` 的公有成员函数) |
| 杂项                                                         |                                                              |
| [ sync](https://cppreference.cn/w/cpp/io/basic_istream/sync) | 与底层存储设备同步  (`std::basic_istream<CharT,Traits>` 的公有成员函数) |

 成员类

| [ sentry](https://cppreference.cn/w/cpp/io/basic_istream/sentry) | 实现为输入操作准备流的基本逻辑  (`std::basic_istream<CharT,Traits>` 的公有成员类) |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
|                                                              |                                                              |

### 

###  [std::basic_ostream](https://cppreference.cn/w/cpp/io/basic_ostream)

 成员函数

| 格式化输出                                                   |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| [ operator<<](https://cppreference.cn/w/cpp/io/basic_ostream/operator_ltlt) | 插入格式化数据  (`std::basic_ostream<CharT,Traits>` 的公开成员函数) |
| 非格式化输出                                                 |                                                              |
| [ put](https://cppreference.cn/w/cpp/io/basic_ostream/put)   | 插入一个字符  (`std::basic_ostream<CharT,Traits>` 的公开成员函数) |
| [ write](https://cppreference.cn/w/cpp/io/basic_ostream/write) | 插入字符块  (`std::basic_ostream<CharT,Traits>` 的公开成员函数) |
| 定位                                                         |                                                              |
| [ tellp](https://cppreference.cn/w/cpp/io/basic_ostream/tellp) | 返回输出位置指示器  (`std::basic_ostream<CharT,Traits>` 的公开成员函数) |
| [ seekp](https://cppreference.cn/w/cpp/io/basic_ostream/seekp) | 设置输出位置指示器  (`std::basic_ostream<CharT,Traits>` 的公开成员函数) |
| 杂项                                                         |                                                              |
| [ flush](https://cppreference.cn/w/cpp/io/basic_ostream/flush) | 与底层存储设备同步  (`std::basic_ostream<CharT,Traits>` 的公开成员函数) |

 成员类

| [ sentry](https://cppreference.cn/w/cpp/io/basic_ostream/sentry) | 实现为输出操作准备流的基本逻辑  (`std::basic_ostream<CharT,Traits>` 的公开成员类) |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
|                                                              |                                                              |

###  [std::basic_ios](https://cppreference.cn/w/cpp/io/basic_ios)

 成员类型

| 成员类型      | 定义               |
| ------------- | ------------------ |
| `char_type`   | `CharT`            |
| `traits_type` | `Traits`           |
| `int_type`    | `Traits::int_type` |
| `pos_type`    | `Traits::pos_type` |
| `off_type`    | `Traits::off_type` |

 成员函数

| 状态函数                                                     |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| [ good](https://cppreference.cn/w/cpp/io/basic_ios/good)     | 检查是否没有错误发生，即 I/O 操作可用  (`std::basic_ios<CharT,Traits>` 的公开成员函数) |
| [ eof](https://cppreference.cn/w/cpp/io/basic_ios/eof)       | 检查是否已到达文件末尾  (`std::basic_ios<CharT,Traits>` 的公开成员函数) |
| [ fail](https://cppreference.cn/w/cpp/io/basic_ios/fail)     | 检查是否发生错误  (`std::basic_ios<CharT,Traits>` 的公开成员函数) |
| [ bad](https://cppreference.cn/w/cpp/io/basic_ios/bad)       | 检查是否发生不可恢复的错误  (`std::basic_ios<CharT,Traits>` 的公开成员函数) |
| [ operator!](https://cppreference.cn/w/cpp/io/basic_ios/operator!) | 检查是否发生错误 (`fail()` 的同义词)  (`std::basic_ios<CharT,Traits>` 的公开成员函数) |
| [ operator bool](https://cppreference.cn/w/cpp/io/basic_ios/operator_bool) | 检查是否没有错误发生 (`!`[fail()](https://cppreference.cn/w/cpp/io/basic_ios/fail) 的同义词)  (`std::basic_ios<CharT,Traits>` 的公开成员函数) |
| [ rdstate](https://cppreference.cn/w/cpp/io/basic_ios/rdstate) | 返回状态标志  (`std::basic_ios<CharT,Traits>` 的公开成员函数) |
| [ setstate](https://cppreference.cn/w/cpp/io/basic_ios/setstate) | 设置状态标志  (`std::basic_ios<CharT,Traits>` 的公开成员函数) |
| [ clear](https://cppreference.cn/w/cpp/io/basic_ios/clear)   | 修改状态标志  (`std::basic_ios<CharT,Traits>` 的公开成员函数) |
| 格式化                                                       |                                                              |
| [ copyfmt](https://cppreference.cn/w/cpp/io/basic_ios/copyfmt) | 复制格式化信息  (`std::basic_ios<CharT,Traits>` 的公开成员函数) |
| [ fill](https://cppreference.cn/w/cpp/io/basic_ios/fill)     | 管理填充字符  (`std::basic_ios<CharT,Traits>` 的公开成员函数) |
| 杂项                                                         |                                                              |
| [ exceptions](https://cppreference.cn/w/cpp/io/basic_ios/exceptions) | 管理异常掩码  (`std::basic_ios<CharT,Traits>` 的公开成员函数) |
| [ imbue](https://cppreference.cn/w/cpp/io/basic_ios/imbue)   | 设置区域设置  (`std::basic_ios<CharT,Traits>` 的公开成员函数) |
| [ rdbuf](https://cppreference.cn/w/cpp/io/basic_ios/rdbuf)   | 管理关联的流缓冲区  (`std::basic_ios<CharT,Traits>` 的公开成员函数) |
| [ tie](https://cppreference.cn/w/cpp/io/basic_ios/tie)       | 管理绑定的流  (`std::basic_ios<CharT,Traits>` 的公开成员函数) |
| [ narrow](https://cppreference.cn/w/cpp/io/basic_ios/narrow) | 窄化字符  (`std::basic_ios<CharT,Traits>` 的公开成员函数)    |
| [ widen](https://cppreference.cn/w/cpp/io/basic_ios/widen)   | 宽化字符  (`std::basic_ios<CharT,Traits>` 的公开成员函数)    |

###  [std::ios_base](https://cppreference.cn/w/cpp/io/ios_base)

 成员函数

| 格式化                                                       |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| [ flags](https://cppreference.cn/w/cpp/io/ios_base/flags)    | 管理格式标志  (`std::ios_base` 的公开成员函数)               |
| [ setf](https://cppreference.cn/w/cpp/io/ios_base/setf)      | 设置特定格式标志  (`std::ios_base` 的公开成员函数)           |
| [ unsetf](https://cppreference.cn/w/cpp/io/ios_base/unsetf)  | 清除特定格式标志  (`std::ios_base` 的公开成员函数)           |
| [ precision](https://cppreference.cn/w/cpp/io/ios_base/precision) | 管理浮点运算的十进制精度  (`std::ios_base` 的公开成员函数)   |
| [ width](https://cppreference.cn/w/cpp/io/ios_base/width)    | 管理字段宽度  (`std::ios_base` 的公开成员函数)               |
| 区域设置                                                     |                                                              |
| [ imbue](https://cppreference.cn/w/cpp/io/ios_base/imbue)    | 设置区域设置  (`std::ios_base` 的公开成员函数)               |
| [ getloc](https://cppreference.cn/w/cpp/io/ios_base/getloc)  | 返回当前区域设置  (`std::ios_base` 的公开成员函数)           |
| 内部可扩展数组                                               |                                                              |
| [ xalloc](https://cppreference.cn/w/cpp/io/ios_base/xalloc)[静态] | 返回程序范围唯一的整数，可以安全地用作 [`pword()`](https://cppreference.cn/w/cpp/io/ios_base/pword) 和 [`iword()`](https://cppreference.cn/w/cpp/io/ios_base/iword) 的索引  (`std::ios_base` 的公开静态成员函数) |
| [ iword](https://cppreference.cn/w/cpp/io/ios_base/iword)    | 如有必要，调整私有存储的大小，并访问给定索引处的 `long` 元素  (`std::ios_base` 的公开成员函数) |
| [ pword](https://cppreference.cn/w/cpp/io/ios_base/pword)    | 如有必要，调整私有存储的大小，并访问给定索引处的 `void*` 元素  (`std::ios_base` 的公开成员函数) |
| 杂项                                                         |                                                              |
| [ register_callback](https://cppreference.cn/w/cpp/io/ios_base/register_callback) | 注册事件回调函数  (`std::ios_base` 的公开成员函数)           |
| [ sync_with_stdio](https://cppreference.cn/w/cpp/io/ios_base/sync_with_stdio)[静态] | 设置 C++ 和 C I/O 库是否可互操作  (`std::ios_base` 的公开静态成员函数) |
| 成员类                                                       |                                                              |
| [ failure](https://cppreference.cn/w/cpp/io/ios_base/failure) | 流异常  (`std::ios_base` 的公开成员类)                       |
| [ Init](https://cppreference.cn/w/cpp/io/ios_base/Init)      | 初始化标准流对象  (`std::ios_base` 的公开成员类)             |

| 成员类型和常量                                               |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 类型                                                         | 说明                                                         |
| [ openmode](https://cppreference.cn/w/cpp/io/ios_base/openmode) | 流打开模式类型还定义了以下常量  常量 说明   [`app`](https://cppreference.cn/w/cpp/io/ios_base/openmode) 每次写入前定位到流的末尾   [`binary`](https://cppreference.cn/w/cpp/io/ios_base/openmode) 以 [二进制模式](https://cppreference.cn/w/cpp/io/c/FILE#Binary_and_text_modes) 打开   [`in`](https://cppreference.cn/w/cpp/io/ios_base/openmode) 打开以供读取   [`out`](https://cppreference.cn/w/cpp/io/ios_base/openmode) 打开以供写入   [`trunc`](https://cppreference.cn/w/cpp/io/ios_base/openmode) 打开时丢弃流的内容   [`ate`](https://cppreference.cn/w/cpp/io/ios_base/openmode) 打开后立即定位到流的末尾   [`noreplace`](https://cppreference.cn/w/cpp/io/ios_base/openmode) (C++23) 以独占模式打开    (typedef) |
| [ fmtflags](https://cppreference.cn/w/cpp/io/ios_base/fmtflags) | 格式化标志类型还定义了以下常量  常量 说明   [`dec`](https://cppreference.cn/w/cpp/io/ios_base/fmtflags) 对整数 I/O 使用十进制基数：参见 [std::dec](https://cppreference.cn/w/cpp/io/manip/hex)   [`oct`](https://cppreference.cn/w/cpp/io/ios_base/fmtflags) 对整数 I/O 使用八进制基数：参见 [std::oct](https://cppreference.cn/w/cpp/io/manip/hex)   [`hex`](https://cppreference.cn/w/cpp/io/ios_base/fmtflags) 对整数 I/O 使用十六进制基数：参见 [std::hex](https://cppreference.cn/w/cpp/io/manip/hex)   [`basefield`](https://cppreference.cn/w/cpp/io/ios_base/fmtflags)  dec | oct | hex。用于掩码操作   [`left`](https://cppreference.cn/w/cpp/io/ios_base/fmtflags) 左对齐（向右添加填充字符）：参见 [std::left](https://cppreference.cn/w/cpp/io/manip/left)   [`right`](https://cppreference.cn/w/cpp/io/ios_base/fmtflags) 右对齐（向左添加填充字符）：参见 [std::right](https://cppreference.cn/w/cpp/io/manip/left)   [`internal`](https://cppreference.cn/w/cpp/io/ios_base/fmtflags) 内部对齐（向内部指定点添加填充字符）：参见 [std::internal](https://cppreference.cn/w/cpp/io/manip/left)   [`adjustfield`](https://cppreference.cn/w/cpp/io/ios_base/fmtflags)  left | right | internal。用于掩码操作   [`scientific`](https://cppreference.cn/w/cpp/io/ios_base/fmtflags) 使用科学计数法生成浮点类型，或者如果与 `fixed` 结合使用则使用十六进制计数法：参见 [std::scientific](https://cppreference.cn/w/cpp/io/manip/fixed)   [`fixed`](https://cppreference.cn/w/cpp/io/ios_base/fmtflags) 使用定点计数法生成浮点类型，或者如果与 `scientific` 结合使用则使用十六进制计数法：参见 [std::fixed](https://cppreference.cn/w/cpp/io/manip/fixed)   [`floatfield`](https://cppreference.cn/w/cpp/io/ios_base/fmtflags)  scientific | fixed。用于掩码操作   [`boolalpha`](https://cppreference.cn/w/cpp/io/ios_base/fmtflags) 插入和提取 bool 类型，采用字母数字格式：参见 [std::boolalpha](https://cppreference.cn/w/cpp/io/manip/boolalpha)   [`showbase`](https://cppreference.cn/w/cpp/io/ios_base/fmtflags) 为整数输出生成指示数字基数的前缀，在货币 I/O 中需要货币指示符：参见 [std::showbase](https://cppreference.cn/w/cpp/io/manip/showbase)   [`showpoint`](https://cppreference.cn/w/cpp/io/ios_base/fmtflags) 为浮点数输出无条件生成小数点字符：参见 [std::showpoint](https://cppreference.cn/w/cpp/io/manip/showpoint)   [`showpos`](https://cppreference.cn/w/cpp/io/ios_base/fmtflags) 为非负数输出生成 + 字符：参见 [std::showpos](https://cppreference.cn/w/cpp/io/manip/showpos)   [`skipws`](https://cppreference.cn/w/cpp/io/ios_base/fmtflags) 在某些输入操作之前跳过前导空白符：参见 [std::skipws](https://cppreference.cn/w/cpp/io/manip/skipws)   [`unitbuf`](https://cppreference.cn/w/cpp/io/ios_base/fmtflags) 在每次输出操作后刷新输出：参见 [std::unitbuf](https://cppreference.cn/w/cpp/io/manip/unitbuf)   [`uppercase`](https://cppreference.cn/w/cpp/io/ios_base/fmtflags) 在某些输出操作中，将某些小写字母替换为其大写等效项：参见 [std::uppercase](https://cppreference.cn/w/cpp/io/manip/uppercase)    (typedef) |
| [ iostate](https://cppreference.cn/w/cpp/io/ios_base/iostate) | 流类型的状态还定义了以下常量  常量 说明   [`goodbit`](https://cppreference.cn/w/cpp/io/ios_base/iostate) 没有错误   [`badbit`](https://cppreference.cn/w/cpp/io/ios_base/iostate) 不可恢复的流错误   [`failbit`](https://cppreference.cn/w/cpp/io/ios_base/iostate) 输入/输出操作失败（格式化或提取错误）   [`eofbit`](https://cppreference.cn/w/cpp/io/ios_base/iostate) 关联的输入序列已到达文件末尾    (typedef) |
| [ seekdir](https://cppreference.cn/w/cpp/io/ios_base/seekdir) | 寻址方向类型还定义了以下常量  常量 说明   [`beg`](https://cppreference.cn/w/cpp/io/ios_base/seekdir) 流的开始   [`end`](https://cppreference.cn/w/cpp/io/ios_base/seekdir) 流的结尾   [`cur`](https://cppreference.cn/w/cpp/io/ios_base/seekdir) 流位置指示器的当前位置    (typedef) |
| [ event](https://cppreference.cn/w/cpp/io/ios_base/event)    | 指定事件类型  (enum)                                         |
| [ event_callback](https://cppreference.cn/w/cpp/io/ios_base/event_callback) | 回调函数类型  (typedef)                                      |



## 文件 I/O

### [basic_ifstream](https://cppreference.cn/w/cpp/io/basic_ifstream)

```C
#include <fstream>
#include <iostream>
#include <string>
 
int main()
{
    std::string filename = "Test.b";
 
    // prepare a file to read
    double d = 3.14;
    std::ofstream(filename, std::ios::binary)
        .write(reinterpret_cast<char*>(&d), sizeof d) << 123 << "abc";
 
    // open file for reading
    std::ifstream istrm(filename, std::ios::binary);
    if (!istrm.is_open())
        std::cout << "failed to open " << filename << '\n';
    else
    {
        double d;
        istrm.read(reinterpret_cast<char*>(&d), sizeof d); // binary input
        int n;
        std::string s;
        if (istrm >> n >> s)                               // text input
            std::cout << "read back from file: " << d << ' ' << n << ' ' << s << '\n';
    }
}
```



### [basic_ostream](https://cppreference.cn/w/cpp/io/basic_ofstream)

```cpp
#include <fstream>
#include <iostream>
#include <string>
 
int main()
{
    std::string filename = "Test.b";
    {
        std::ofstream ostrm(filename, std::ios::binary);
        double d = 3.14;
        ostrm.write(reinterpret_cast<char*>(&d), sizeof d); // binary output
        ostrm << 123 << "abc" << '\n';                      // text output
    }
 
    // read back
    std::ifstream istrm(filename, std::ios::binary);
    double d;
    istrm.read(reinterpret_cast<char*>(&d), sizeof d);
    int n;
    std::string s;
    istrm >> n >> s;
    std::cout << " read back: " << d << ' ' << n << ' ' << s << '\n';
}
```



### [basic_fstream](https://cppreference.cn/w/cpp/io/basic_fstream)

```cpp
#include <fstream>
#include <iostream>
#include <string>
 
int main()
{
    std::string filename{"test.bin"};
    std::fstream s{filename, s.binary | s.trunc | s.in | s.out};
 
    if (!s.is_open())
        std::cout << "failed to open " << filename << '\n';
    else
    {
        // write
        double d{3.14};
        s.write(reinterpret_cast<char*>(&d), sizeof d); // binary output
        s << 123 << "abc";                              // text output
 
        // for fstream, this moves the file position pointer (both put and get)
        s.seekp(0);
 
        // read
        d = 2.71828;
        s.read(reinterpret_cast<char*>(&d), sizeof d); // binary input
        int n;
        std::string str;
        if (s >> n >> str)                             // text input
            std::cout << "read back from file: " << d << ' ' << n << ' ' << str << '\n';
    }
}
```

## 文件操作

### filesystem

```cpp
#include <filesystem>
#include <iostream>
#include <fstream>
#include <chrono>
#include <iomanip>
#include <functional>

namespace fs = std::filesystem;

int main() {
    // 创建测试目录和文件
    fs::create_directory("test_dir");
    std::ofstream("test_dir/file.txt") << "Hello, Filesystem!";
    fs::create_directory("test_dir/subdir");
    
    // 1. path 类使用
    fs::path p{"test_dir/file.txt"};
    std::cout << "当前路径: " << p << std::endl;
    std::cout << "文件名: " << p.filename() << std::endl;
    std::cout << "扩展名: " << p.extension() << std::endl;
    std::cout << "父目录: " << p.parent_path() << std::endl;
    
    // 2. 绝对路径和规范路径
    std::cout << "绝对路径: " << fs::absolute(p) << std::endl;
    std::cout << "规范路径: " << fs::canonical(p) << std::endl;
    
    // 3. 文件操作
    // 复制文件
    fs::copy(p, "test_dir/file_copy.txt");
    
    // 重命名文件
    fs::rename("test_dir/file_copy.txt", "test_dir/file_renamed.txt");
    
    // 获取文件大小
    std::cout << "文件大小: " << fs::file_size(p) << " 字节" << std::endl;
    
    // 4. 目录操作
    // 目录迭代器
    std::cout << "\n目录内容:" << std::endl;
    for (const auto& entry : fs::directory_iterator("test_dir")) {
        std::cout << "  " << entry.path() << std::endl;
    }
    
    // 递归目录迭代器
    std::cout << "\n递归目录内容:" << std::endl;
    for (const auto& entry : fs::recursive_directory_iterator("test_dir")) {
        std::cout << "  " << entry.path() << std::endl;
    }
    
    // 5. 文件状态和权限
    auto status = fs::status(p);
    std::cout << "\n文件类型: ";
    switch (status.type()) {
        case fs::file_type::regular: std::cout << "常规文件"; break;
        case fs::file_type::directory: std::cout << "目录"; break;
        default: std::cout << "其他"; break;
    }
    std::cout << std::endl;
    
    // 修改权限 (添加所有用户可读权限)
    fs::permissions(p, fs::perms::group_all | fs::perms::others_all, 
                   fs::perm_options::add);
    
    // 6. 文件时间操作
    auto ftime = fs::last_write_time(p);
    std::time_t cftime = decltype(ftime)::clock::to_time_t(ftime);
    std::cout << "最后修改时间: " << std::asctime(std::localtime(&cftime));
    
    // 7. 空间信息
    auto space = fs::space("/");
    std::cout << "磁盘空间信息:" << std::endl;
    std::cout << "  总容量: " << space.capacity << " 字节" << std::endl;
    std::cout << "  可用空间: " << space.free << " 字节" << std::endl;
    std::cout << "  可用空间(非特权): " << space.available << " 字节" << std::endl;
    
    // 8. 文件类型检查函数
    std::cout << "\n文件类型检查:" << std::endl;
    std::cout << "  是常规文件: " << fs::is_regular_file(p) << std::endl;
    std::cout << "  是目录: " << fs::is_directory("test_dir") << std::endl;
    std::cout << "  目录为空: " << fs::is_empty("test_dir/subdir") << std::endl;
    
    // 9. 创建符号链接和硬链接
    fs::create_symlink("file.txt", "test_dir/file_symlink.txt");
    // fs::create_hard_link(p, "test_dir/file_hardlink.txt"); // 可能需要管理员权限
    
    // 10. 临时目录
    std::cout << "临时目录: " << fs::temp_directory_path() << std::endl;
    
    // 清理
    fs::remove_all("test_dir");
    
    return 0;
}
```

### filesystem::path

`path` 类型的对象表示文件系统上的路径。仅处理路径的语法方面：路径名可以表示不存在的路径，甚至是不允许在当前文件系统或操作系统上存在的路径。

路径名具有以下语法

1.  **根名(可选)：标识具有多个根的文件系统上的根（例如 "C:" 或 "//myserver"）。在有歧义的情况下，形成有效根名的最长字符序列被视为根名**。标准库可以定义操作系统 API 理解之外的其他根名。

2.  根目录(可选)：**目录分隔符，如果存在，则将此路径标记为*绝对*。**如果它缺失（并且根名之外的第一个元素是文件名），则该路径是*相对*的，并且需要另一个路径作为起始位置以解析为文件名。

3. 以下零个或多个

   * 文件名：不是目录分隔符或首选目录分隔符的字符序列（操作系统或文件系统可能会施加其他限制）。此名称可以标识文件、硬链接、符号链接或目录。识别两个特殊的文件名
     * 点：由单个点字符 `.` 组成的文件名是一个目录名，它**引用当前目录。**
     * 点点：由两个点字符 `..` 组成的文件名是一个目录名，它**引用父目录。**

   * 目录分隔符：**正斜杠字符 / 或作为 path::preferred_separator 提供的替代字符**。如果重复此字符，则将其视为单个目录分隔符：/usr///////lib 与 /usr/lib 相同。



可以通过以下算法*规范化*路径

1. 如果路径为空，则停止（空路径的规范形式是空路径）。
2. 将每个目录分隔符（可能由多个斜杠组成）替换为单个 `path::preferred_separator`。
3. 将根名中的每个斜杠字符替换为 `path::preferred_separator`。
4. 删除每个点和任何紧随其后的目录分隔符。
5. 删除每个非点点文件名，紧随其后的是目录分隔符和点点，以及任何紧随其后的目录分隔符。
6. 如果存在根目录，则删除所有点点以及紧随其后的任何目录分隔符。
7. 如果最后一个文件名是点点，则删除任何尾随的目录分隔符。
8. 如果路径为空，则添加一个点（./ 的规范形式是 .）。

可以通过 [begin()](https://cppreference.cn/w/cpp/filesystem/path/begin) 和 [end()](https://cppreference.cn/w/cpp/filesystem/path/begin) 函数返回的迭代器逐元素遍历路径，这些函数以通用格式查看路径，并迭代根名、根目录和后续文件名元素（目录分隔符被跳过，除了标识根目录的那个）。如果路径中最后一个元素是目录分隔符，则最后一个迭代器将解引用为空元素。

调用 `path` 的任何非 const 成员函数都会使所有引用该对象元素的迭代器无效。

如果操作系统使用与上面描述的可移植*通用*语法不同的*本机*语法，则定义为接受“检测到的格式”的库函数会接受两种格式的路径名：如果检测到的格式参数与通用格式匹配但不被操作系统接受为本机路径，则认为该参数采用通用格式。在目录路径名和文件路径名之间本机格式不同的操作系统上，通用路径名如果以目录分隔符结尾，则被视为目录路径，否则被视为常规文件。

在任何情况下，路径类都表现得好像它以本机格式存储路径名，并在需要时自动转换为通用格式（每个成员函数都指定了它将路径解释为哪种格式）。

在 POSIX 系统上，通用格式是本机格式，无需区分或转换它们。

路径可以隐式地与 [std::basic_string](https://cppreference.cn/w/cpp/string/basic_string) 相互转换，这使得可以将它们与其他文件 API 一起使用。

[流运算符](https://cppreference.cn/w/cpp/filesystem/path/operator_ltltgtgt) 使用 [std::quoted](https://cppreference.cn/w/cpp/io/manip/quoted)，以便在稍后被 [流输入运算符](https://cppreference.cn/w/cpp/filesystem/path/operator_ltltgtgt) 读取时，空格不会导致截断。

[分解成员函数](https://cppreference.cn/w/cpp/filesystem/path#Decomposition)（例如 [extension](https://cppreference.cn/w/cpp/filesystem/path/extension)）返回 `filesystem::path` 对象，而不是像其他 API 那样返回字符串对象。



####  成员类型

| 类型                                                         | 定义                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| `value_type`                                                 | 文件系统的本机编码使用的字符类型：POSIX 上为 char，Windows 上为 wchar_t |
| `string_type`                                                | [std::basic_string](https://cppreference.cn/w/cpp/string/basic_string)<value_type> |
| `const_iterator`                                             | 一个常量 [*旧式输入迭代器*](https://cppreference.cn/w/cpp/named_req/InputIterator)，其 `value_type` 为 `path`，满足 [*旧式双向迭代器*](https://cppreference.cn/w/cpp/named_req/BidirectionalIterator) 的所有要求，除了对于类型为 `const_iterator` 的两个相等的可解引用迭代器 `a` 和 `b`，没有要求 *a 和 *b 引用同一个对象。不指定 `const_iterator` 是否实际上是 [*旧式双向迭代器*](https://cppreference.cn/w/cpp/named_req/BidirectionalIterator) |
| `iterator`                                                   | `const_iterator`                                             |
| [ format](https://cppreference.cn/w/cpp/filesystem/path/format) | 确定如何解释路径名的字符串表示形式。还定义了以下枚举器  名称 说明   [`native_format`](https://cppreference.cn/w/cpp/filesystem/path/format) 本机路径名格式   [`generic_format`](https://cppreference.cn/w/cpp/filesystem/path/format) 通用路径名格式   [`auto_format`](https://cppreference.cn/w/cpp/filesystem/path/format) 实现定义的格式，尽可能自动检测  （公共成员枚举） |

####  成员常量

| constexpr value_type preferred_separator[静态] | 除了可移植的 / 之外，还可以使用的替代目录分隔符。在 Windows 上，这是反斜杠字符 \。在 POSIX 上，这与可移植分隔符相同的正斜杠 /  (公共静态成员常量) |
| ---------------------------------------------- | ------------------------------------------------------------ |
|                                                |                                                              |



####  成员函数

| [ （构造函数）](https://cppreference.cn/w/cpp/filesystem/path/path) | 构造一个 `path`  (公共成员函数)                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| [ （析构函数）](https://cppreference.cn/w/cpp/filesystem/path/~path) | 销毁一个 `path` 对象  (公共成员函数)                         |
| [ operator=](https://cppreference.cn/w/cpp/filesystem/path/operator%3D) | 赋值另一个路径  (公共成员函数)                               |
| [ assign](https://cppreference.cn/w/cpp/filesystem/path/assign) | 赋值内容  (公共成员函数)                                     |
| 连接                                                         |                                                              |
| [ appendoperator/=](https://cppreference.cn/w/cpp/filesystem/path/append) | 将元素附加到带有目录分隔符的路径  (公共成员函数)             |
| [ concatoperator+=](https://cppreference.cn/w/cpp/filesystem/path/concat) | 连接两个路径，不引入目录分隔符  (公共成员函数)               |
| 修饰符                                                       |                                                              |
| [ clear](https://cppreference.cn/w/cpp/filesystem/path/clear) | 擦除内容  (公共成员函数)                                     |
| [ make_preferred](https://cppreference.cn/w/cpp/filesystem/path/make_preferred) | 将目录分隔符转换为首选目录分隔符  (公共成员函数)             |
| [ remove_filename](https://cppreference.cn/w/cpp/filesystem/path/remove_filename) | 删除文件名路径组件  (公共成员函数)                           |
| [ replace_filename](https://cppreference.cn/w/cpp/filesystem/path/replace_filename) | 将最后一个路径组件替换为另一个路径  (公共成员函数)           |
| [ replace_extension](https://cppreference.cn/w/cpp/filesystem/path/replace_extension) | 替换扩展名  (公共成员函数)                                   |
| [ swap](https://cppreference.cn/w/cpp/filesystem/path/swap)  | 交换两个路径  (公共成员函数)                                 |
| 格式观察器                                                   |                                                              |
| [ c_strnativeoperator string_type](https://cppreference.cn/w/cpp/filesystem/path/native) | 返回路径的本机版本  (公共成员函数)                           |
| [ stringwstringu8stringu16stringu32string](https://cppreference.cn/w/cpp/filesystem/path/string) | 以本机路径名格式返回转换为字符串的路径  (公共成员函数)       |
| [ generic_stringgeneric_wstringgeneric_u8stringgeneric_u16stringgeneric_u32string](https://cppreference.cn/w/cpp/filesystem/path/generic_string) | 以通用路径名格式返回转换为字符串的路径  (公共成员函数)       |
| 比较                                                         |                                                              |
| [ compare](https://cppreference.cn/w/cpp/filesystem/path/compare) | 按字典顺序比较两个路径的词法表示形式  (公共成员函数)         |
| 生成                                                         |                                                              |
| [ lexically_normallexically_relativelexically_proximate](https://cppreference.cn/w/cpp/filesystem/path/lexically_normal) | 将路径转换为规范形式 将路径转换为相对形式 将路径转换为近似形式  (公共成员函数) |
| 分解                                                         |                                                              |
| [ root_name](https://cppreference.cn/w/cpp/filesystem/path/root_name) | 返回路径的根名（如果存在）  (公共成员函数)                   |
| [ root_directory](https://cppreference.cn/w/cpp/filesystem/path/root_directory) | 返回路径的根目录（如果存在）  (公共成员函数)                 |
| [ root_path](https://cppreference.cn/w/cpp/filesystem/path/root_path) | 返回路径的根路径（如果存在）  (公共成员函数)                 |
| [ relative_path](https://cppreference.cn/w/cpp/filesystem/path/relative_path) | 返回相对于根路径的路径  (公共成员函数)                       |
| [ parent_path](https://cppreference.cn/w/cpp/filesystem/path/parent_path) | 返回父路径的路径  (公共成员函数)                             |
| [ filename](https://cppreference.cn/w/cpp/filesystem/path/filename) | 返回文件名路径组件  (公共成员函数)                           |
| [ stem](https://cppreference.cn/w/cpp/filesystem/path/stem)  | 返回词干路径组件（不带最终扩展名的文件名）  (公共成员函数)   |
| [ extension](https://cppreference.cn/w/cpp/filesystem/path/extension) | 返回文件扩展名路径组件  (公共成员函数)                       |
| 查询                                                         |                                                              |
| [ empty](https://cppreference.cn/w/cpp/filesystem/path/empty) | 检查路径是否为空  (公共成员函数)                             |
| [ has_root_pathhas_root_namehas_root_directoryhas_relative_pathhas_parent_pathhas_filenamehas_stemhas_extension](https://cppreference.cn/w/cpp/filesystem/path/has_path) | 检查相应的路径元素是否不为空  (公共成员函数)                 |
| [ is_absoluteis_relative](https://cppreference.cn/w/cpp/filesystem/path/is_absrel) | 检查 [root_path()](https://cppreference.cn/w/cpp/filesystem/path/root_path) 是否唯一标识文件系统位置  (公共成员函数) |
| 迭代器                                                       |                                                              |
| [ beginend](https://cppreference.cn/w/cpp/filesystem/path/begin) | 作为元素序列的路径的迭代器访问  (公共成员函数)               |

####  非成员函数

| 定义于命名空间 `std::filesystem`                             |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| [ swap(std::filesystem::path)](https://cppreference.cn/w/cpp/filesystem/path/swap2)(C++17) | 特化 [std::swap](https://cppreference.cn/w/cpp/algorithm/swap) 算法  (函数) |
| [ hash_value](https://cppreference.cn/w/cpp/filesystem/path/hash_value)(C++17) | 计算路径对象的哈希值  (函数)                                 |
| [ operator==operator!=operatoroperator>=operator<=>](https://cppreference.cn/w/cpp/filesystem/path/operator_cmp)(C++17)(C++17)(C++20 前)(C++17)(C++20 前)(C++17)(C++20 前)(C++17)(C++20 前)(C++17)(C++20 前)(C++20) | 按字典顺序比较两个路径  (函数)                               |
| [ operator/](https://cppreference.cn/w/cpp/filesystem/path/operator_slash)(C++17) | 连接两个带有目录分隔符的路径  (函数)                         |
| [ operator<>](https://cppreference.cn/w/cpp/filesystem/path/operator_ltltgtgt)(C++17) | 对带引号的路径执行流输入和输出  (函数)                       |
| [ u8path](https://cppreference.cn/w/cpp/filesystem/path/u8path)(C++17)(在 C++20 中已弃用) | 从 UTF-8 编码的源创建 `path`  (函数)                         |

####  辅助类

| 定义于命名空间 `std`                                         |                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------- |
| [ std::hash](https://cppreference.cn/w/cpp/filesystem/path/hash)(C++17) | 对 **`std::filesystem::path`** 的哈希支持  (类模板特化) |
| [ std::formatter](https://cppreference.cn/w/cpp/filesystem/path/formatter)(C++26) | 对 `filesystem::path` 的格式化支持  (类模板特化)        |

#### 使用示例

```c
#include <filesystem>
#include <iostream>
namespace fs = std::filesystem;
 
int main()
{
    fs::path p = fs::current_path();
 
    std::cout << "The current path " << p << " decomposes into:\n"
              << "root name " << p.root_name() << '\n'
              << "root directory " << p.root_directory() << '\n'
              << "relative path " << p.relative_path() << '\n';
}
/*
可能的输出

The current path "C:\Users\abcdef\Local Settings\temp" decomposes into:
root name "C:"
root directory "\"
relative path "Users\abcdef\Local Settings\temp"
*/
```



------



### C++17 Filesystem 库功能分类说明

#### 1. 路径操作 (Path Operations)

| 功能        | 描述                             | 示例                                     |
| ----------- | -------------------------------- | ---------------------------------------- |
| `path` 类   | 表示和操作文件系统路径           | `fs::path p{"dir/file.txt"};`            |
| `absolute`  | 获取绝对路径                     | `fs::absolute("file.txt")`               |
| `canonical` | 获取规范路径（解析所有符号链接） | `fs::canonical("file.txt")`              |
| `relative`  | 获取相对路径                     | `fs::relative("/a/b", "/a")` // 返回 "b" |
| `proximate` | 获取近似相对路径                 | 类似于 relative                          |

#### 2. 文件和目录操作 (File and Directory Operations)

| 功能                 | 描述                  | 示例                                  |
| -------------------- | --------------------- | ------------------------------------- |
| `copy`               | 复制文件或目录        | `fs::copy("src.txt", "dst.txt")`      |
| `copy_file`          | 复制文件内容          | `fs::copy_file("src.txt", "dst.txt")` |
| `create_directory`   | 创建新目录            | `fs::create_directory("new_dir")`     |
| `create_directories` | 递归创建目录          | `fs::create_directories("a/b/c")`     |
| `remove`             | 删除文件或空目录      | `fs::remove("file.txt")`              |
| `remove_all`         | 递归删除目录及其内容  | `fs::remove_all("dir")`               |
| `rename`             | 移动或重命名文件/目录 | `fs::rename("old.txt", "new.txt")`    |
| `resize_file`        | 调整文件大小          | `fs::resize_file("file.txt", 1024)`   |

#### 3. 文件和目录查询 (File and Directory Queries)

| 功能              | 描述                         | 示例                                          |
| ----------------- | ---------------------------- | --------------------------------------------- |
| `exists`          | 检查路径是否存在             | `fs::exists("file.txt")`                      |
| `equivalent`      | 检查两个路径是否指向同一文件 | `fs::equivalent("a.txt", "b.txt")`            |
| `file_size`       | 获取文件大小                 | `fs::file_size("file.txt")`                   |
| `hard_link_count` | 获取硬链接数量               | `fs::hard_link_count("file.txt")`             |
| `last_write_time` | 获取或设置最后修改时间       | `auto time = fs::last_write_time("file.txt")` |
| `is_empty`        | 检查文件或目录是否为空       | `fs::is_empty("dir")`                         |

#### 4. 目录迭代 (Directory Iteration)

| 功能                           | 描述             | 示例                                                      |
| ------------------------------ | ---------------- | --------------------------------------------------------- |
| `directory_iterator`           | 遍历目录内容     | `for (auto& e : fs::directory_iterator("dir"))`           |
| `recursive_directory_iterator` | 递归遍历目录     | `for (auto& e : fs::recursive_directory_iterator("dir"))` |
| `directory_entry`              | 表示目录中的条目 | `fs::directory_entry entry{"file.txt"}`                   |

#### 5. 文件类型检查 (File Type Checking)

| 功能                | 描述               | 示例                                |
| ------------------- | ------------------ | ----------------------------------- |
| `is_regular_file`   | 检查是否为常规文件 | `fs::is_regular_file("file.txt")`   |
| `is_directory`      | 检查是否为目录     | `fs::is_directory("dir")`           |
| `is_symlink`        | 检查是否为符号链接 | `fs::is_symlink("link")`            |
| `is_block_file`     | 检查是否为块设备   | `fs::is_block_file("/dev/sda")`     |
| `is_character_file` | 检查是否为字符设备 | `fs::is_character_file("/dev/tty")` |
| `is_fifo`           | 检查是否为命名管道 | `fs::is_fifo("fifo")`               |
| `is_socket`         | 检查是否为套接字   | `fs::is_socket("socket")`           |
| `is_other`          | 检查是否为其他类型 | `fs::is_other("file")`              |

#### 6. 链接操作 (Link Operations)

| 功能                       | 描述             | 示例                                             |
| -------------------------- | ---------------- | ------------------------------------------------ |
| `create_symlink`           | 创建符号链接     | `fs::create_symlink("target", "link")`           |
| `create_directory_symlink` | 创建目录符号链接 | `fs::create_directory_symlink("target", "link")` |
| `create_hard_link`         | 创建硬链接       | `fs::create_hard_link("target", "link")`         |
| `read_symlink`             | 读取符号链接目标 | `fs::read_symlink("link")`                       |

#### 7. 权限和状态 (Permissions and Status)

| 功能             | 描述             | 示例                                                |
| ---------------- | ---------------- | --------------------------------------------------- |
| `status`         | 获取文件状态     | `auto s = fs::status("file.txt")`                   |
| `symlink_status` | 获取符号链接状态 | `auto s = fs::symlink_status("link")`               |
| `permissions`    | 修改文件权限     | `fs::permissions("file.txt", fs::perms::owner_all)` |
| `file_status`    | 表示文件状态信息 | `fs::file_status status`                            |
| `perms`          | 文件权限枚举     | `fs::perms::owner_read | fs::perms::owner_write`    |

#### 8. 磁盘空间 (Disk Space)

| 功能         | 描述                 | 示例                      |
| ------------ | -------------------- | ------------------------- |
| `space`      | 获取磁盘空间信息     | `auto s = fs::space("/")` |
| `space_info` | 存储空间信息的结构体 | `fs::space_info`          |

#### 9. 其他功能 (Miscellaneous)

| 功能                  | 描述                   | 示例                                  |
| --------------------- | ---------------------- | ------------------------------------- |
| `current_path`        | 获取或设置当前工作目录 | `fs::current_path()`                  |
| `temp_directory_path` | 获取临时目录路径       | `fs::temp_directory_path()`           |
| `filesystem_error`    | 文件系统异常类         | `throw fs::filesystem_error("error")` |
| `hash<path>`          | path 的哈希支持        | `std::hash<fs::path>{}(p)`            |

#### 10. 枚举类型 (Enumerations)

| 枚举                | 描述                               |
| ------------------- | ---------------------------------- |
| `file_type`         | 文件类型（常规、目录、符号链接等） |
| `perms`             | 文件权限（读、写、执行等）         |
| `copy_options`      | 复制操作选项（覆盖、跳过存在等）   |
| `directory_options` | 目录迭代选项（跟随符号链接等）     |
| `perm_options`      | 权限操作选项（添加、移除、替换等） |

这个分类说明和代码示例展示了 C++17 Filesystem 库的主要功能，涵盖了路径操作、文件操作、目录遍历、权限管理等常见文件系统任务。

## 控制台IO | `iomanip`

### 1. 示例1

```C
#include <iostream>
#include <iomanip>
#include <sstream>
#include <string>
#include <chrono>
#include <numbers>
int main() {
    //std::cout.imbue(std::locale("en_US.utf8"));

    // 1. setw - 设置字段宽度
    std::cout << "1. setw 示例:" << std::endl;
    std::cout.setf(std::ios_base::left);
    std::cout << std::setw(10) << "Hello" << std::setw(10) << "World" << std::endl;
    std::cout.unsetf(std::ios_base::left);
    std::cout.setf(std::ios_base::right);
    std::cout << std::setw(10) << 123 << std::setw(10) << 4567 << std::endl;
    std::cout.unsetf(std::ios_base::right);
    std::cout << std::endl;

    // 2. setfill - 设置填充字符
    std::cout << "2. setfill 示例:" << std::endl;
    std::cout << std::setfill('*') << std::setw(10) << 123 << std::endl;
    std::cout << std::setfill(' ') << std::setw(10) << 123 << std::endl; // 恢复空格填充
    std::cout << std::endl;

    // 3. setprecision - 设置浮点数精度
    std::cout << "3. setprecision 示例:" << std::endl;
    double pi = std::numbers::pi_v<double>;
    std::cout << "默认: " << pi << std::endl;
    std::cout << "精度2: " << std::setprecision(2) << pi << std::endl;
    std::cout << "精度5: " << std::setprecision(5) << pi << std::endl;
    std::cout << "精度10: " << std::setprecision(10) << pi << std::endl;
    std::cout << std::endl;

    // 4. setbase - 设置数值基数
    std::cout << "4. setbase 示例:" << std::endl;
    int num = 255;
    // std::cout.setf(std::ios_base::showbase); // 显示基数
    // std::cout.setf(std::ios_base::hex); // 显示十六进制
    // std::cout.setf(std::ios_base::oct); // 显示八进制
    // std::cout.setf(std::ios_base::dec); // 显示十进制
    std::cout << "十进制: " << std::setbase(10) << num << std::endl;
    std::cout << "八进制: " << std::setbase(8) << num << std::endl;
    std::cout << "十六进制: " << std::setbase(16) << num << std::endl;
    std::cout << std::endl;

    // 5. setiosflags - 设置格式标志
    std::cout.setf(std::ios_base::dec);
    std::cout << "5. setiosflags 和 resetiosflags 示例:" << std::endl;
    std::cout << "默认: " << 100 << std::endl;
    std::cout << std::setiosflags(std::ios::showbase | std::ios::uppercase);
    std::cout << "显示基数和大写: " << std::setbase(16) << 100 << std::endl;
    std::cout << std::resetiosflags(std::ios::showbase | std::ios::uppercase);
    // or std::cout.unsetf(std::ios_base::hex);
    std::cout << "重置后: " << std::setbase(10) << 100 << std::endl;
    std::cout << std::endl;

    // 6. get_money 和 put_money - 货币格式
    // 输出1235，why? 货币是分，小数四舍五入还是向上取整
    std::cout << "6. get_money 和 put_money 示例:" << std::endl;
    long double money = 1234.56;
    std::cout << "金额: " << std::put_money(money) << std::endl;

    // 输出1234，why? 小数舍弃还是向下取整
    std::istringstream money_stream("1234.56");
    long double extracted_money;
    money_stream >> std::get_money(extracted_money, true);
    std::cout << "解析的金额: " << extracted_money << std::endl;
    std::cout << std::endl;

    // 7. get_time 和 put_time - 时间格式
    std::cout << "7. get_time 和 put_time 示例:" << std::endl;
    std::time_t t = std::time(nullptr);
    std::tm tm = *std::localtime(&t);

    std::cout << "当前时间: " << std::put_time(&tm, "%Y-%m-%d %H:%M:%S") << std::endl;

    std::istringstream time_stream("2023-10-15 14:30:00");
    std::tm parsed_tm = {};
    time_stream >> std::get_time(&parsed_tm, "%Y-%m-%d %H:%M:%S");
    if (!time_stream.fail()) {
        std::cout << "解析的时间: " << std::put_time(&parsed_tm, "%Y-%m-%d %H:%M:%S") << std::endl;
    }
    else {
        std::cout << "时间解析失败" << std::endl;
    }
    std::cout << std::endl;

    // 8. quoted - 处理带引号的字符串
    std::cout << "8. quoted 示例:" << std::endl;
    std::string text = "Hello, World!";
    std::cout << "原始字符串: " << text << std::endl;
    std::cout << "带引号输出: " << std::quoted(text) << std::endl;

    std::istringstream quoted_stream("\"Quoted String\"");
    std::string extracted_text;
    quoted_stream >> std::quoted(extracted_text);
    std::cout << "解析的带引号字符串: " << extracted_text << std::endl;

    // 带自定义分隔符和转义字符的 quoted
    std::cout << "自定义引号: " << std::quoted(text, '\'', '\\') << std::endl;

    std::istringstream custom_quoted_stream("'It\\'s quoted'");
    std::string custom_extracted;
    custom_quoted_stream >> std::quoted(custom_extracted, '\'', '\\');
    std::cout << "解析的自定义引号字符串: " << custom_extracted << std::endl;
    return 0;
}
```

### 2. 示例2（lambda结合参数包打印）

```c
#include <print>
#include <tuple>
#include <utility>
#include <iostream>
int main() {
    auto print1 = []<typename...Args>(Args&&...args1) -> void {
        [&/*can write as -> "...args2 = std::forward<Args>(args1)"*/]() {
            (std::print("{} ", args1), ...);
            }();
    };
    auto print2 = [](auto&&...args) -> void {
        [&] <std::size_t...idx>(std::index_sequence<idx...>) {
            (std::print("{} ", std::get<idx>(std::forward_as_tuple(args...))/*C++26 can write as -> "args...[idx]"*/), ...);
        }(std::make_index_sequence<sizeof...(args)>{});
        };
    auto print3 = [] <typename... Args>(Args&&... args) {
        /*C++26 can add "template" before for*/for (auto arg : { args... }) {
            std::print("{} ", arg);
        }
    };
    print1("1", "2", "3");
    print2("1", "2", "3");
    print3("1", "2", "3");
    std::cout << std::endl;
    return 0;
}

```

------



# 四、注意事项

单个`<<`运算输出是线程安全的，而`std::cout` 输出了多个`<<`则不是线程安全的，解决办法，将所有内容写到`ostringstream`，然后统一输出，或者使用`std::osyncstream`

------



# 五、文件写入与数据丢失：从用户态到内核缓冲

在进行开发时，许多程序需要将处理结果导出到文件中，以便用户查看、存档或进一步分析。比如，在数据分析、图像编辑、游戏等应用中，程序会生成一些结果数据或操作记录，需要导出成文件格式（如 CSV、TXT、JSON、图片文件等），以便用户保存或与他人共享。

我们一般也就是正常的使用标准库或者框架的接口进行文件的写入。比如使用 [`std::ofstream`](https://zh.cppreference.com/w/cpp/io/basic_ofstream)、`QFile`。

那么问题来了，当写入函数执行完毕后，文件真的被写入到硬件设备上了吗？这看起来是个简单的问题，但它涉及到了用户态中库实现与操作系统中文件系统的缓冲和刷新机制。

## 写入文件

先从简单的开始吧，我们读取写入一个文件会编写怎么样的代码呢？

```cpp
#include <iostream>
#include <fstream>
#include <thread>

int main() {
    // 创建一个文件输出流对象，打开目标文件
    std::ofstream file{"output.txt"};

    if (!file) {
        std::cerr << "文件打开失败!" << std::endl;
        return 1;
    }

    // 写入数据到文件
    file << "Hello, World!";
    file << "这是一些需要写入文件的数据。";

    // 关闭文件并刷新用户态缓冲区
    file.close();
    std::cout << "数据已成功写入到 output.txt" << std::endl;
}
```

`close()` 调用实际上是冗余的，因为当 file 对象析构时，会自动调用 close()。

在 C++ 标准库中，写入文件时，数据首先被写入到库内部的用户态缓冲区中。这样做的目的是为了**减少系统调用次数以提高效率**，尤其是在频繁进行小规模写入时。通过使用缓冲区，多个写入操作可以**合并成一次批量写入**，减少 I/O 操作的开销。

几乎所有的库都会使用缓冲区来优化文件操作，这是一种非常常见的做法。在上述代码中，你可以在 `file.close()` 之前设置断点，或者 sleep，你会发现，只有在刷新了用户态缓冲区之后，数据才被写入了文件。

但事情真的是这样吗？刷新用户态缓冲区并不意味着数据立即写入到硬件设备中。

- **数据首先会从用户态缓冲区写入内核缓冲区**，之后才可能被实际写入磁盘。

操作系统的文件系统会在合适的时机将数据从内核缓冲区刷新到硬件设备。如果我们需要确保文件真的写入了，需要显式的使用 [`fsync`](https://pubs.opengroup.org/onlinepubs/9799919799/functions/fsync.html) 函数，或者`sync` 等命令，才能真正的确保文件被写入。

## 读取文件

假设你传递了一个磁盘路径进行对文件进行操作（读取，复制，查看大小），并且操作成功了，这时文件真的已经存在吗？

在上一节我们清楚了：**当你调用了写入文件的函数，数据通常会首先存储在用户态缓冲区中，当我们刷新了缓冲区就会传输到内核缓冲区**。

```cpp
write(file_path);
flush;
read(file_path);
```

读取成功了，那么会不会出现一种情况：**这里写文件函数调用完成，也刷新了用户态缓冲到内核缓冲区，但是还没有真的写入磁盘？**

这种情况是完全可能的。那么，为什么在这种情况下我们仍然能够**成功读取**文件呢？

- **虽然此时数据可能还没有完全写入硬件设备（磁盘），但是操作系统文件系统会提供抽象，使得你在读取文件时，能从内核缓冲区中看到数据。**

也就是让用户感觉好像真的写入了一样，“*如同写入*”，有点类似于一个映射。

通常情况下，作为开发者你无需过多关注这一点，因为内核会管理这些缓冲操作。然而，**如果发生了突然断电或磁盘被强制拔出，未能及时刷新到硬件的内核缓冲区中的数据就会丢失**。

## 测试

环境：`x86_64 Ubuntu22.04`

你可以使用下面的代码进行测试。为了更方便地观察结果，推荐使用移动存储设备进行测试。尽管原理是相同的，这种方式更直观。

```cpp
#include <iostream>
#include <filesystem>
#include <unistd.h>
#include <fcntl.h>
#include <string.h>

void sync_file_with_fsync(const std::filesystem::path& dest_path) {
    int fd = open(dest_path.c_str(), O_WRONLY);
    if (fd == -1) {
        std::cerr << "无法打开文件进行 fsync: " << strerror(errno) << std::endl;
        return;
    }

    if (fsync(fd) == -1) {
        std::cerr << "fsync 失败: " << strerror(errno) << std::endl;
    } else {
        std::cout << "fsync 成功，数据已写入磁盘。" << std::endl;
    }
    close(fd);
}

int main(){
    std::filesystem::path source_path = "/home/mq-b/test/test_fsync/1MB_file.dat";
    std::filesystem::path dest_path = "/media/mq-b/MQ-B/1MB_file.dat";
    std::filesystem::copy_file(source_path, dest_path, std::filesystem::copy_options::overwrite_existing);

    sync_file_with_fsync(dest_path);

    std::clog << dest_path << " 文件复制完成,大小：" << std::filesystem::file_size(dest_path) << " Byte" << std::endl;
}
```

用 `1MB` 大小的文件复制进行测试，[`filesystem::copy_file`](https://zh.cppreference.com/w/cpp/filesystem/copy_file) 会自动刷新用户态缓冲，无需手动处理。

通过注释与使用 `sync_file_with_fsync` 函数调用来进行观察。

1. 你可以使用 `VMware` 虚拟机，在虚拟机中的 Linux 系统编译并执行这段代码。
2. 插入一个移动存储设备（修改路径以匹配你的设备）。
3. 执行程序后，观察输出，程序会显示 `... 文件复制完成,大小：` 这样的信息。
4. 此时暂停虚拟机，切换到 Windows 系统。
5. 使用 windows 系统打开移动存储设备，你会发现，尽管复制函数已经执行完毕，且文件大小也显示正确，但**文件内容并没有被实际写入硬盘**。这是因为 [`file_size`](https://zh.cppreference.com/w/cpp/filesystem/file_size) 获取的是内核缓冲区中的信息，而非磁盘上的实际数据。

使用 `sync_file_with_fsync` 便**不会出现数据丢失**，因为其中 `fsync` 会将内核缓冲区的缓存都写入到物理存储中。

## 总结

在文件写入操作中，数据通常首先存储在用户态缓冲区（尽管某些接口，如 POSIX 的 write，没有用户态的缓冲）。我们可以选择手动刷新缓冲区，或者等待库在适当时机自动刷新，将数据写入到内核缓冲区。

此时，尽管文件尚未完全写入硬盘，我们仍然可以读取文件内容，但读取到的只是内核缓冲区中的数据。

在合适的时机，内核缓冲区会自动刷新，或者我们手动调用 `fsync` 等函数，数据才会最终写入物理存储设备。

一般情况下我们无需关心以上这些内容，但是如果要确保数据被硬件设备存储，就一定要注意刷新内核缓冲区。比如导出数据到 U盘，或者用户显式点击保存。

1. 数据导出到 U盘，但是你没注意刷新内核缓冲，程序流程继续执行，弹窗“**导出成功**”。用户直接拔出 U盘，然后发现**根本没有数据**，因为数据还存在内核缓冲中。

2. 用户显式 Ctrl + S 保存了编辑的文件，提示：“**已保存**”，此时停电了。用户在来电后打开电脑发现文件根本没保存。

以上两种不管哪种都不应该出现。
